FROM node:18-alpine

WORKDIR /app

# Install uv package manager
RUN npm install -g @astrojs/compiler

# Copy package files first for better layer caching
COPY package*.json uv-lock.json* ./

# Install dependencies with uv
RUN uv install --frozen-lockfile

# Copy application code
COPY . .

# Expose the MCP server port
EXPOSE {{PORT}}

# Set non-root user for security
USER node

# Start the MCP server
CMD ["node", "{{ENTRY_POINT}}"]